import { getToken } from './api.js';

// Helper function to fetch authenticated images and return blob URL
export async function fetchAuthenticatedImage(url: string): Promise<string | null> {
	try {
		const token = getToken();
		if (!token) return null;

		const response = await fetch(url, {
			headers: {
				'Authorization': `Bearer ${token}`
			}
		});

		if (!response.ok) {
			console.error('Failed to fetch image:', response.status);
			return null;
		}

		const blob = await response.blob();
		return URL.createObjectURL(blob);
	} catch (error) {
		console.error('Error fetching authenticated image:', error);
		return null;
	}
}

// Helper to load avatar with fallback
export async function loadAvatar(avatarUrl: string | null): Promise<string> {
	if (!avatarUrl) {
		return '/default-avatar.png';
	}

	const authenticatedUrl = await fetchAuthenticatedImage(avatarUrl);
	return authenticatedUrl || '/default-avatar.png';
}
